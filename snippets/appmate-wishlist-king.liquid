{% assign wkShopName = shop.name | replace: '&amp;', '&' %}

<script>
  Shopify.theme.settings = Shopify.theme.settings || {};
  Shopify.theme.settings['product_swap_images'] = {{ settings.show_secondary_image_on_hover }};
  Shopify.theme.settings['enable_quick_add'] = {{ settings.enable_quick_add }};
  Shopify.theme.settings['show_swatches'] = {{ settings.show_swatches }};
  Shopify.theme.settings['show_swatches_on_hover'] = {{ settings.show_swatches_on_hover }};
</script>

<script type="text/javascript">
  function initAppmate(Appmate){
    Appmate.wk.on({
      'click [data-wk-add-product]': eventHandler(function(){
        var productId = this.getAttribute('data-wk-add-product');
        var select = Appmate.wk.$('form select[name="id"]');
        var variantId = select.length ? select.val() : undefined;
        Appmate.wk.addProduct(productId, variantId).then(function(product) {
          var variant = product.selected_or_first_available_variant || {};
          sendTracking({
            hitType: 'event',
            eventCategory: 'Wishlist',
            eventAction: 'WK Added Product',
            eventLabel: 'Wishlist King',
          }, {
            id: variant.sku || variant.id,
            name: product.title,
            category: product.type,
            brand: product.vendor,
            variant: variant.title,
            price: variant.price
          }, {
            list: "{{ wkListTitle }}" || undefined
          });
        });
      }),
      'click [data-wk-remove-product]': eventHandler(function(){
        var productId = this.getAttribute('data-wk-remove-product');
        Appmate.wk.removeProduct(productId).then(function(product) {
          var variant = product.selected_or_first_available_variant || {};
          document.querySelector('#product-id-' + productId).remove();
          sendTracking({
            hitType: 'event',
            eventCategory: 'Wishlist',
            eventAction: 'WK Removed Product',
            eventLabel: 'Wishlist King',
          }, {
            id: variant.sku || variant.id,
            name: product.title,
            category: product.type,
            brand: product.vendor,
            variant: variant.title,
            price: variant.price
          }, {
            list: "{{ wkListTitle }}" || undefined
          });
        });
      }),
      'click [data-wk-remove-item]': eventHandler(function(){
        var itemId = this.getAttribute('data-wk-remove-item');
        fadeOrNot(this, function() {
          Appmate.wk.removeItem(itemId).then(function(product){
            var variant = product.selected_or_first_available_variant || {};
            sendTracking({
              hitType: 'event',
              eventCategory: 'Wishlist',
              eventAction: 'WK Removed Product',
              eventLabel: 'Wishlist King',
            }, {
              id: variant.sku || variant.id,
              name: product.title,
              category: product.type,
              brand: product.vendor,
              variant: variant.title,
              price: variant.price
            }, {
              list: "{{ wkListTitle }}" || undefined
            });
          });
        });
      }),
      'click [data-wk-clear-wishlist]': eventHandler(function(){
        var wishlistId = this.getAttribute('data-wk-clear-wishlist');
        Appmate.wk.clear(wishlistId).then(function() {
          sendTracking({
            hitType: 'event',
            eventCategory: 'Wishlist',
            eventAction: 'WK Cleared Wishlist',
            eventLabel: 'Wishlist King',
          });
        });
      }),
      'click [data-wk-share]': eventHandler(function(){
        var params = {
          wkShareService: this.getAttribute("data-wk-share-service"),
          wkShare: this.getAttribute("data-wk-share"),
          wkShareImage: this.getAttribute("data-wk-share-image")
        };
        var shareLink = Appmate.wk.getShareLink(params);

        sendTracking({
          hitType: 'event',
          eventCategory: 'Wishlist',
          eventAction: 'WK Shared Wishlist (' + params.wkShareService + ')',
          eventLabel: 'Wishlist King',
        });

        switch (params.wkShareService) {
          case 'link':
            Appmate.wk.$('#wk-share-link-text').addClass('wk-visible').find('.wk-text').html(shareLink);
            var copyButton = Appmate.wk.$('#wk-share-link-text .wk-clipboard');
            var copyText = copyButton.html();
            var clipboard = Appmate.wk.clipboard(copyButton[0]);
            clipboard.on('success', function(e) {
              copyButton.html('copied');
              setTimeout(function(){
                copyButton.html(copyText);
              }, 2000);
            });
            break;
          case 'email':
            window.location.href = shareLink;
            break;
          case 'contact':
            var contactUrl = '/pages/contact';
            var message = 'Here is the link to my list:\n' + shareLink;
            window.location.href=contactUrl + '?message=' + encodeURIComponent(message);
            break;
          default:
            window.open(
              shareLink,
              'wishlist_share',
              'height=590, width=770, toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, directories=no, status=no'
            );
        }
      }),
      'click [data-wk-move-to-cart]': eventHandler(function(){
        var $elem = Appmate.wk.$(this);
        $form = $elem.parents('form');
        $elem.prop("disabled", true);

        var item = this.getAttribute('data-wk-move-to-cart');
        var formData = $form.serialize();

        fadeOrNot(this, function(){
          Appmate.wk
          .moveToCart(item, formData)
          .then(function(product){
            $elem.prop("disabled", false);

            var variant = product.selected_or_first_available_variant || {};
            sendTracking({
              hitType: 'event',
              eventCategory: 'Wishlist',
              eventAction: 'WK Added to Cart',
              eventLabel: 'Wishlist King',
              hitCallback: function() {
                window.scrollTo(0, 0);
                location.reload();
              }
            }, {
              id: variant.sku || variant.id,
              name: product.title,
              category: product.type,
              brand: product.vendor,
              variant: variant.title,
              price: variant.price,
              quantity: 1,
            }, {
              list: "{{ wkListTitle }}" || undefined
            });
          });
        });
      }),
      'render .wk-option-select': function(elem){
        appmateOptionSelect(elem);
      },
      'login-required': function (intent) {
        var redirect = {
          path: window.location.pathname,
          intent: intent
        };
        window.location = '/account/login?wk-redirect=' + encodeURIComponent(JSON.stringify(redirect));
      },
      'render .swiper-container': function (elem) {
        // initSlider()
      },
      'ready': function () {
        // Appmate.wk.$(document).ready(initSlider);
        fillContactForm();

        var redirect = Appmate.wk.getQueryParam('wk-redirect');
        if (redirect) {
          Appmate.wk.addLoginRedirect(Appmate.wk.$('#customer_login'), JSON.parse(redirect));
        }
        var intent = Appmate.wk.getQueryParam('wk-intent');
        if (intent) {
          intent = JSON.parse(intent);
          switch (intent.action) {
            case 'addProduct':
              Appmate.wk.addProduct(intent.product, intent.variant)
              break;
            default:
              console.warn('Wishlist King: Intent not implemented', intent)
          }
          if (window.history && window.history.pushState) {
            history.pushState(null, null, window.location.pathname);
          }
        }
      }
    });

    Appmate.init({
      shop: {
        domain: '{{ shop.permanent_domain }}'
      },
      session: {
        customer: '{{ customer.id }}'
      },
      globals: {
        settings: {
          app_wk_icon: '{{ settings.app_wk_icon }}',
          app_wk_share_enable: '{{ settings.app_wk_share_enable }}',
          app_wk_products_per_row: {{ settings.app_wk_products_per_row }},
          money_format: '{{ shop.money_with_currency_format }}'
        },
        customer: '{{ customer.id }}',
        customer_accounts_enabled: {{ shop.customer_accounts_enabled }},
      },
      wishlist: {
        filter: function(product) {
          return !product.hidden;
        },
        loginRequired: {{ settings.app_wk_login_required }},
        handle: "/pages/wishlist",
        proxyHandle: "/a/wk",
        share: {
          handle: "/pages/shared-wishlist",
          title: 'My Wishlist',
          description: 'Check out some of my favorite things @ {{ wkShopName }}.',
          imageTitle: '{{ wkShopName }}',
          hashTags: 'wishlist',
          twitterUser: false // will be used with via
        }
      }
    });

    function sendTracking(event, product, action) {
      if (typeof fbq === 'function') {
        switch (event.eventAction) {
          case "WK Added Product":
            fbq('track', 'AddToWishlist', {
              value: product.price,
              currency: '{{ shop.currency }}'
            });
            break;
        }
      }
      if (typeof ga === 'function') {
        if (product) {
          delete product.price;
          ga('ec:addProduct', product);
        }

        if (action) {
          ga('ec:setAction', 'click', action);
        }

        if (event) {
          ga('send', event);
        }

        if (!ga.loaded) {
          event && event.hitCallback && event.hitCallback()
        }
      } else {
        event && event.hitCallback && event.hitCallback()
      }
    }

    function initSlider () {
      if (typeof Swiper !== 'undefined') {
        var mySwiper = new Swiper ('.swiper-container', {
          direction: 'horizontal',
          loop: false,
          pagination: '.swiper-pagination',
          nextButton: '.swiper-button-next',
          prevButton: '.swiper-button-prev',
          spaceBetween: 20,
          slidesPerView: 4,
          breakpoints: {
            380: {
              slidesPerView: 1,
              spaceBetween: 0,
            },
            480: {
              slidesPerView: 2,
              spaceBetween: 20,
            }
          }
        })
      }
    }

    function fillContactForm() {
      document.addEventListener('DOMContentLoaded', fillContactForm)
      if (document.getElementById('contact_form')) {
        var message = Appmate.wk.getQueryParam('message');
        var bodyElement = document.querySelector("#contact_form textarea[name='contact[body]']");
        if (bodyElement && message) {
          bodyElement.value = message;
        }
      }
    }

    function eventHandler (callback) {
      return function (event) {
        if (typeof callback === 'function') {
          callback.call(this, event)
        }
        if (event) {
          event.preventDefault();
          event.stopPropagation();
        }
      }
    }

    function fadeOrNot(elem, callback){
      if (typeof $ !== "function") {
        callback();
        return;
      }
      var $elem = $(elem);
  	  if ($elem.parents('.wk-fadeout').length) {
        $elem.parents('.wk-fadeout').fadeOut(callback);
      } else {
        callback();
      }
    }
  }
</script>

<script
  type="text/template"
  id="wishlist-product-item-template"
>
  <div class="grid__item" id="product-id-@@id@@">
    <div id="wk-item-@@wkItemId@@" class="product-item product-item--wishlist js-product" data-wk-item="@@wkItemId@@">
      <div class="product__media @@mediaClass@@">
        <a
          href="@@url@@"
          title="View product"
          class="product__image @@imageClass@@"
          style="@@imageUrl@@"
          role="img"
          aria-label="@@altText@@"
        ></a>
        @@swapImage@@
      </div>

      <a href="#" data-wk-remove-product="@@id@@" class="product__wishlist-remove" title="Remove product">
        <svg xmlns="http://www.w3.org/2000/svg" width="8.707" height="8.707" viewBox="0 0 8.707 8.707"><path class="a" d="M9,0,1,8M9,8,1,0" transform="translate(-0.646 0.354)"/></svg>
      </a>

      <div class="product__content">
        <div class="product__meta">
          <div class="product__meta-row">
            <h4>
              <a href="@@url@@" title="View product">@@title@@</a>
            </h4>
            
            <span class="price js-product-price">@@price@@</span>
          </div>
        </div>

        <div class="product__form">
          <form method="post" action="/cart/add" id="product_form_@@id@@" accept-charset="UTF-8" class="form-product js-product-form" enctype="multipart/form-data">
            <input type="hidden" name="form_type" value="product">
            <input type="hidden" name="utf8" value="✓">

            <select name="id" class="hidden">@@options@@</select>

            <input
              type="hidden"
              name="updates[]"
              class="js-product-quantity"
              value="1"
            >

            @@formOptions@@
          </form>
        </div>
      </div>
    </div>
  </div>
</script>

{% raw %}

<script
  id="wishlist-icon-filled"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  {% if settings.app_wk_icon == "heart" %}
    <svg version='1.1' xmlns='https://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 64 64'>
      <path d='M47.199 4c-6.727 0-12.516 5.472-15.198 11.188-2.684-5.715-8.474-11.188-15.201-11.188-9.274 0-16.8 7.527-16.8 16.802 0 18.865 19.031 23.812 32.001 42.464 12.26-18.536 31.999-24.2 31.999-42.464 0-9.274-7.527-16.802-16.801-16.802z' fill='#000'></path>
    </svg>
  {% elsif settings.app_wk_icon == "star" %}
    <svg version='1.1' xmlns='https://www.w3.org/2000/svg' width='64' height='60.9' viewBox='0 0 64 64'>
      <path d='M63.92,23.25a1.5,1.5,0,0,0-1.39-1H40.3L33.39,1.08A1.5,1.5,0,0,0,32,0h0a1.49,1.49,0,0,0-1.39,1L23.7,22.22H1.47a1.49,1.49,0,0,0-1.39,1A1.39,1.39,0,0,0,.6,24.85l18,13L11.65,59a1.39,1.39,0,0,0,.51,1.61,1.47,1.47,0,0,0,.88.3,1.29,1.29,0,0,0,.88-0.3l18-13.08L50,60.68a1.55,1.55,0,0,0,1.76,0,1.39,1.39,0,0,0,.51-1.61l-6.9-21.14,18-13A1.45,1.45,0,0,0,63.92,23.25Z' fill='#be8508'></path>
    </svg>
  {% endif %}
</script>

<script
  id="wishlist-icon-empty"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  {% if settings.app_wk_icon == "heart" %}
    <svg version='1.1' xmlns='https://www.w3.org/2000/svg' width='64px' height='60.833px' viewBox='0 0 64 60.833'>
      <path stroke='#000' stroke-width='5' stroke-miterlimit='10' fill-opacity='0' d='M45.684,2.654c-6.057,0-11.27,4.927-13.684,10.073 c-2.417-5.145-7.63-10.073-13.687-10.073c-8.349,0-15.125,6.776-15.125,15.127c0,16.983,17.134,21.438,28.812,38.231 c11.038-16.688,28.811-21.787,28.811-38.231C60.811,9.431,54.033,2.654,45.684,2.654z'/>
    </svg>
  {% elsif settings.app_wk_icon == "star" %}
    <svg version='1.1' xmlns='https://www.w3.org/2000/svg' width='64' height='60.9' viewBox='0 0 64 64'>
      <path d='M63.92,23.25a1.5,1.5,0,0,0-1.39-1H40.3L33.39,1.08A1.5,1.5,0,0,0,32,0h0a1.49,1.49,0,0,0-1.39,1L23.7,22.22H1.47a1.49,1.49,0,0,0-1.39,1A1.39,1.39,0,0,0,.6,24.85l18,13L11.65,59a1.39,1.39,0,0,0,.51,1.61,1.47,1.47,0,0,0,.88.3,1.29,1.29,0,0,0,.88-0.3l18-13.08L50,60.68a1.55,1.55,0,0,0,1.76,0,1.39,1.39,0,0,0,.51-1.61l-6.9-21.14,18-13A1.45,1.45,0,0,0,63.92,23.25ZM42.75,36.18a1.39,1.39,0,0,0-.51,1.61l5.81,18L32.85,44.69a1.41,1.41,0,0,0-1.67,0L15.92,55.74l5.81-18a1.39,1.39,0,0,0-.51-1.61L6,25.12H24.7a1.49,1.49,0,0,0,1.39-1L32,6.17l5.81,18a1.5,1.5,0,0,0,1.39,1H58Z' fill='#be8508'></path>
    </svg>
  {% endif %}
</script>

<script
  id="wishlist-icon-remove"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  <svg role="presentation" viewBox="0 0 16 14">
    <path d="M15 0L1 14m14 0L1 0" stroke="currentColor" fill="none" fill-rule="evenodd"></path>
  </svg>
</script>

<script
  id="wishlist-link"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  {% if wishlist.item_count %}
    {% assign link_icon = 'wishlist-icon-filled' %}
  {% else %}
    {% assign link_icon = 'wishlist-icon-empty' %}
  {% endif %}
  <a href="{{ wishlist.url }}" class="wk-link wk-{{ wishlist.state }}" title="View Wishlist"><span class="wk-label">My Wishlist</span> <span class="wk-count">({{ wishlist.item_count }})</span></a>
</script>

<script
  id="wishlist-link-li"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  <li class="wishlist-link-li wk-{{ wishlist.state }}">
    {% include 'wishlist-link' %}
  </li>
</script>

<script
  id="wishlist-button-product"
  data="product"
  type="text/x-template"
  app="wishlist-king"
>
  {% if product.in_wishlist %}
    {% assign btn_text = 'In Wishlist' %}
    {% assign btn_title = 'Remove from Wishlist' %}
    {% assign btn_action = 'wk-remove-product' %}
    {% assign btn_icon = 'wishlist-icon-filled' %}
  {% else %}
    {% assign btn_text = 'Add to Wishlist' %}
    {% assign btn_title = 'Add to Wishlist' %}
    {% assign btn_action = 'wk-add-product' %}
    {% assign btn_icon = 'wishlist-icon-empty' %}
  {% endif %}

  <button type="button" class="wk-button-product {{ btn_action }}" title="{{ btn_title }}" data-{{ btn_action }}="{{ product.id }}">
    <div class="wk-icon">
      {% include btn_icon %}
    </div>
    <span class="wk-label">{{ btn_text }}</span>
  </button>
</script>

<script
  id="wishlist-button-collection"
  data="product"
  type="text/x-template"
  app="wishlist-king"
>
  {% if product.in_wishlist %}
    {% assign btn_text = 'In Wishlist' %}
    {% assign btn_title = 'Remove from Wishlist' %}
    {% assign btn_action = 'wk-remove-product' %}
    {% assign btn_icon = 'wishlist-icon-filled' %}
  {% else %}
    {% assign btn_text = 'Add to Wishlist' %}
    {% assign btn_title = 'Add to Wishlist' %}
    {% assign btn_action = 'wk-add-product' %}
    {% assign btn_icon = 'wishlist-icon-empty' %}
  {% endif %}

  <button type="button" class="wk-button-collection {{ btn_action }}" title="{{ btn_title }}" data-{{ btn_action }}="{{ product.id }}">
    <div class="wk-icon">
      {% include btn_icon %}
    </div>
    <span class="wk-label">{{ btn_text }}</span>
  </button>
</script>

<script
  id="wishlist-button-wishlist-page"
  data="product"
  type="text/x-template"
  app="wishlist-king"
>
  {% if wishlist.read_only %}
    {% assign item_id = product.id %}
  {% else %}
    {% assign item_id = product.wishlist_item_id %}
  {% endif %}

  {% assign add_class = '' %}
  {% if product.in_wishlist and wishlist.read_only == true %}
    {% assign btn_text = 'In Wishlist' %}
    {% assign btn_title = 'Remove from Wishlist' %}
    {% assign btn_action = 'wk-remove-product' %}
    {% assign btn_icon = 'wishlist-icon-filled' %}
  {% elsif product.in_wishlist and wishlist.read_only == false %}
    {% assign btn_text = 'In Wishlist' %}
    {% assign btn_title = 'Remove from Wishlist' %}
    {% assign btn_action = 'wk-remove-item' %}
    {% assign btn_icon = 'wishlist-icon-remove' %}
    {% assign add_class = 'wk-with-hover' %}
  {% else %}
    {% assign btn_text = 'Add to Wishlist' %}
    {% assign btn_title = 'Add to Wishlist' %}
    {% assign btn_action = 'wk-add-product' %}
    {% assign btn_icon = 'wishlist-icon-empty' %}
    {% assign add_class = 'wk-with-hover' %}
  {% endif %}

  <button type="button" class="wk-button-wishlist-page {{ btn_action }} {{ add_class }} product__wishlist-remove" title="{{ btn_title }}" data-{{ btn_action }}="{{ item_id }}">
    <div class="wk-icon">
      {% include btn_icon %}
    </div>
    <span class="wk-label">{{ btn_text }}</span>
  </button>
</script>

<script
  id="wishlist-button-wishlist-clear"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  {% assign btn_text = 'Clear Wishlist' %}
  {% assign btn_title = 'Clear Wishlist' %}
  {% assign btn_class = 'btn' %}

  <button type="button" class="{{ btn_class }}" title="{{ btn_title }}" data-wk-clear-wishlist="{{ wishlist.permaId }}">
    {{ btn_text }}
  </button>
</script>

<script
  id="wishlist-shared"
  data="shared_wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  {% assign wishlist = shared_wishlist %}
  {% include 'wishlist-collection' with wishlist %}
</script>

<script
  id="wishlist-collection"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  <div class="section__entry">
    {% if wishlist.item_count == 0 %}
      {% include 'wishlist-collection-empty' %}
    {% else %}
      {% if customer_accounts_enabled and customer == false and wishlist.read_only == false %}
        {% include 'wishlist-collection-login-note' %}
      {% endif %}

      {% if settings.app_wk_share_enable %}
        {% unless wishlist.read_only %}
          {% include 'wishlist-collection-share' %}
        {% endunless %}
      {% endif %}
    {% endif %}
  </div>
</script>

<script
  id="wishlist-row"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  <div class='wk-wishlist-row'>
    {% if wishlist.item_count != 0 %}
    <h2 class="wk-wishlist-row-title">Add more from Wishlist</h2>
    <div class="swiper-container">
        <!-- Additional required wrapper -->
        <div class="swiper-wrapper">
            <!-- Slides -->
            {% for product in wishlist.products %}
              {% assign hide_default_title = false %}
              {% if product.variants.length == 1 and product.variants[0].title contains 'Default' %}
                {% assign hide_default_title = true %}
              {% endif %}
              <div
                id="wk-item-{{ product.wishlist_item_id }}"
                class="swiper-slide wk-item wk-fadeout"
                data-wk-item="{{ product.wishlist_item_id }}"
              >
                {% include 'wishlist-collection-product-image' with product %}
                {% include 'wishlist-collection-product-title' with product %}
                {% include 'wishlist-collection-product-price' %}
                {% include 'wishlist-collection-product-form' with product %}
              </div>
            {% endfor %}
        </div>
        <!-- If we need pagination -->
        <!-- <div class="swiper-pagination"></div> -->
    </div>
    <div class="swiper-button-prev">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
          <path d="M0 0h24v24H0z" fill="none"/>
      </svg>
    </div>
    <div class="swiper-button-next">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
          <path d="M0 0h24v24H0z" fill="none"/>
      </svg>
    </div>
    {% endif %}
  </div>
</script>

<script
  id="wishlist-collection-empty"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  <h4>Your wishlist is empty!</h4>
</script>

<script
  id="wishlist-collection-login-note"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  <p>To permanently save your wishlist please <a href="/account/login">login</a> or <a href="/account/register">sign up</a>.</p>
</script>

<script
  id="wishlist-collection-share"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  <h4>Share Wishlist</h4>

  <ul class="socials">
    <li>{% include 'wishlist-share-button-fb' %}</li>
    <li>{% include 'wishlist-share-button-pinterest' %}</li>
    <li>{% include 'wishlist-share-button-twitter' %}</li>
    <li id="wk-share-whatsapp">{% include 'wishlist-share-button-whatsapp' %}</li>
  </ul>
</script>

<script
  id="wishlist-collection-loop"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  <div class="wk-row">
    {% assign item_count = 0 %}
    {% for product in wishlist.products %}
      {% assign item_count = item_count | plus: 1 %}
      {% unless limit and item_count > limit %}
        {% assign hide_default_title = false %}
        {% if product.variants.length == 1 and product.variants[0].title contains 'Default' %}
          {% assign hide_default_title = true %}
        {% endif %}

        {% assign items_per_row = settings.app_wk_products_per_row %}
        {% assign wk_item_width = 100 | divided_by: items_per_row %}

        <div class="wk-item-column" style="width: {{ wk_item_width }}%">
          <div id="wk-item-{{ product.wishlist_item_id }}" class="wk-item {{ wk_item_class }} {% unless wishlist.read_only %}wk-fadeout{% endunless %}" data-wk-item="{{ product.wishlist_item_id }}">

            {% include 'wishlist-collection-product-image' with product %}
            {% include 'wishlist-button-wishlist-page' with product %}
            {% include 'wishlist-collection-product-title' with product %}
            {% include 'wishlist-collection-product-price' %}
            {% include 'wishlist-collection-product-form' with product %}
          </div>
        </div>
      {% endunless %}
    {% endfor %}
  </div>
</script>

<script
  id="wishlist-collection-product-image"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  <div class="wk-image">
    <a href="{{ product | variant_url }}" class="wk-variant-link wk-content" title="View product">
      <img class="wk-variant-image"
         src="{{ product | variant_img_url: '1000x' }}"
         alt="{{ product.title }}" />
    </a>
  </div>
</script>

<script
  id="wishlist-collection-product-title"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  <div class="wk-product-title">
    <a href="{{ product | variant_url }}" class="wk-variant-link" title="View product">{{ product.title }}</a>
  </div>
</script>

<script
  id="wishlist-collection-product-price"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  {% assign variant = product.selected_or_first_available_variant %}

  <div class="wk-purchase">
    <span class="wk-price wk-price-preview">
      {% if variant.price >= variant.compare_at_price %}
      {{ variant.price | money }}
      {% else %}
      <span class="saleprice">{{ variant.price | money }}</span> <del>{{ variant.compare_at_price | money }}</del>
      {% endif %}
    </span>
  </div>
</script>

<script
  id="wishlist-collection-product-form"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  <form id="wk-add-item-form-{{ product.wishlist_item_id }}" action="/cart/add" method="post" class="wk-add-item-form">

    <!-- Begin product options -->
    <div class="wk-product-options {% if hide_default_title %}wk-no-options{% endif %}">

      <div class="wk-select" {% if hide_default_title %} style="display:none"{% endif %}>
        <select id="wk-option-select-{{ product.wishlist_item_id }}" class="wk-option-select" name="id">

          {% for variant in product.variants %}
          <option value="{{ variant.id }}" {% if variant == product.selected_or_first_available_variant %}selected="selected"{% endif %}>
            {{ variant.title }} - {{ variant.price | money }}
          </option>
          {% endfor %}

        </select>
      </div>

      {% comment %}
        {% if settings.display_quantity_dropdown and product.available %}
        <div class="wk-selector-wrapper">
          <label>Quantity</label>
          <input class="wk-quantity" type="number" name="quantity" value="1" class="wk-item-quantity" />
        </div>
        {% endif %}
      {% endcomment %}

      <div class="wk-purchase-section{% if product.variants.length > 1 %} wk-multiple{% endif %}">
        {% unless product.available %}
        <input type="submit" class="wk-add-to-cart disabled" disabled="disabled" value="Sold Out" />
        {% else %}
          {% assign cart_action = 'wk-move-to-cart' %}
          {% if wishlist.read_only %}
            {% assign cart_action = 'wk-add-to-cart' %}
          {% endif %}
          <input type="submit" class="wk-add-to-cart" data-{{ cart_action }}="{{ product.wishlist_item_id }}" name="add" value="Add to Cart" />
        {% endunless %}
      </div>
    </div>
    <!-- End product options -->
  </form>
</script>

<script
  id="wishlist-share-button-fb"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  {% unless wishlist.empty %}
  <a href="#" class="wk-button-share resp-sharing-button__link" title="Share on Facebook" data-wk-share-service="facebook" data-wk-share="{{ wishlist.permaId }}" data-wk-share-image="{{ wishlist.products[0] | variant_img_url: '1200x630' }}">
    <svg xmlns="http://www.w3.org/2000/svg" width="9.641" height="18" viewBox="0 0 9.641 18">
      <path id="Icon_awesome-facebook-f" data-name="Icon awesome-facebook-f" d="M10.618,10.125l.5-3.258H7.992V4.753a1.629,1.629,0,0,1,1.837-1.76H11.25V.22A17.329,17.329,0,0,0,8.728,0C6.153,0,4.471,1.56,4.471,4.385V6.867H1.609v3.258H4.471V18H7.992V10.125Z" transform="translate(-1.609)" fill="#fff"/>
    </svg>
  </a>
  {% endunless %}
</script>

<script
  id="wishlist-share-button-twitter"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  {% unless wishlist.empty %}
  <a href="#" class="wk-button-share resp-sharing-button__link" title="Share on Twitter" data-wk-share-service="twitter" data-wk-share="{{ wishlist.permaId }}">
    <svg xmlns="http://www.w3.org/2000/svg" width="22.162" height="18" viewBox="0 0 22.162 18">
      <path id="Icon_awesome-twitter" data-name="Icon awesome-twitter" d="M19.884,7.867c.014.2.014.394.014.591A12.835,12.835,0,0,1,6.975,21.381,12.836,12.836,0,0,1,0,19.342a9.4,9.4,0,0,0,1.1.056,9.1,9.1,0,0,0,5.639-1.941,4.55,4.55,0,0,1-4.247-3.15,5.728,5.728,0,0,0,.858.07,4.8,4.8,0,0,0,1.2-.155A4.543,4.543,0,0,1,.9,9.765V9.709a4.574,4.574,0,0,0,2.053.577A4.549,4.549,0,0,1,1.547,4.21a12.911,12.911,0,0,0,9.366,4.753A5.128,5.128,0,0,1,10.8,7.923a4.547,4.547,0,0,1,7.861-3.108,8.943,8.943,0,0,0,2.883-1.1,4.53,4.53,0,0,1-2,2.5,9.106,9.106,0,0,0,2.616-.7,9.764,9.764,0,0,1-2.278,2.348Z" transform="translate(0 -3.381)" fill="#fff"/>
    </svg>
  </a>
  {% endunless %}
</script>

<script
  id="wishlist-share-button-pinterest"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  {% unless wishlist.empty %}
  <a href="#" class="wk-button-share resp-sharing-button__link" title="Share on Pinterest" data-wk-share-service="pinterest" data-wk-share="{{ wishlist.permaId }}" data-wk-share-image="{{ wishlist.products[0] | variant_img_url: '1200x630' }}">
    <svg xmlns="http://www.w3.org/2000/svg" width="13.849" height="18" viewBox="0 0 13.849 18">
      <path id="Icon_awesome-pinterest-p" data-name="Icon awesome-pinterest-p" d="M7.357.457C3.657.457,0,2.924,0,6.916,0,9.455,1.428,10.9,2.294,10.9c.357,0,.563-1,.563-1.277C2.856,9.286,2,8.572,2,7.176A4.874,4.874,0,0,1,7.065,2.221c2.456,0,4.274,1.4,4.274,3.96,0,1.915-.768,5.507-3.257,5.507a1.6,1.6,0,0,1-1.666-1.58c0-1.363.952-2.683.952-4.09,0-2.387-3.386-1.955-3.386.93a4.237,4.237,0,0,0,.346,1.828c-.5,2.142-1.515,5.334-1.515,7.541,0,.682.1,1.352.162,2.034.123.137.061.123.249.054,1.818-2.488,1.753-2.975,2.575-6.232a2.925,2.925,0,0,0,2.5,1.3c3.83,0,5.55-3.733,5.55-7.1C13.849,2.794,10.754.457,7.357.457Z" transform="translate(0 -0.457)" fill="#fff"/>
    </svg>
  </a>
  {% endunless %}
</script>

<script
  id="wishlist-share-button-whatsapp"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  {% unless wishlist.empty %}
  <a href="#" class="wk-button-share resp-sharing-button__link" title="Share via WhatsApp" data-wk-share-service="whatsapp" data-wk-share="{{ wishlist.permaId }}">
    <svg xmlns="https://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
      <path stroke="none" d="M20.1,3.9C17.9,1.7,15,0.5,12,0.5C5.8,0.5,0.7,5.6,0.7,11.9c0,2,0.5,3.9,1.5,5.6l-1.6,5.9l6-1.6c1.6,0.9,3.5,1.3,5.4,1.3l0,0l0,0c6.3,0,11.4-5.1,11.4-11.4C23.3,8.9,22.2,6,20.1,3.9z M12,21.4L12,21.4c-1.7,0-3.3-0.5-4.8-1.3l-0.4-0.2l-3.5,1l1-3.4L4,17c-1-1.5-1.4-3.2-1.4-5.1c0-5.2,4.2-9.4,9.4-9.4c2.5,0,4.9,1,6.7,2.8c1.8,1.8,2.8,4.2,2.8,6.7C21.4,17.2,17.2,21.4,12,21.4z M17.1,14.3c-0.3-0.1-1.7-0.9-1.9-1c-0.3-0.1-0.5-0.1-0.7,0.1c-0.2,0.3-0.8,1-0.9,1.1c-0.2,0.2-0.3,0.2-0.6,0.1c-0.3-0.1-1.2-0.5-2.3-1.4c-0.9-0.8-1.4-1.7-1.6-2c-0.2-0.3,0-0.5,0.1-0.6s0.3-0.3,0.4-0.5c0.2-0.1,0.3-0.3,0.4-0.5c0.1-0.2,0-0.4,0-0.5c0-0.1-0.7-1.5-1-2.1C8.9,6.6,8.6,6.7,8.5,6.7c-0.2,0-0.4,0-0.6,0S7.5,6.8,7.2,7c-0.3,0.3-1,1-1,2.4s1,2.8,1.1,3c0.1,0.2,2,3.1,4.9,4.3c0.7,0.3,1.2,0.5,1.6,0.6c0.7,0.2,1.3,0.2,1.8,0.1c0.6-0.1,1.7-0.7,1.9-1.3c0.2-0.7,0.2-1.2,0.2-1.3C17.6,14.5,17.4,14.4,17.1,14.3z"/>
    </svg>
  </a>
  {% endunless %}
</script>

<script
  id="wishlist-share-button-email"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  {% unless wishlist.empty %}
  <a href="#" class="wk-button-share resp-sharing-button__link" title="Share via Email" data-wk-share-service="email" data-wk-share="{{ wishlist.permaId }}">
    <div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--large">
      <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
          <path d="M22,4H2C0.897,4,0,4.897,0,6v12c0,1.103,0.897,2,2,2h20c1.103,0,2-0.897,2-2V6C24,4.897,23.103,4,22,4z M7.248,14.434 l-3.5,2C3.67,16.479,3.584,16.5,3.5,16.5c-0.174,0-0.342-0.09-0.435-0.252c-0.137-0.239-0.054-0.545,0.186-0.682l3.5-2 c0.24-0.137,0.545-0.054,0.682,0.186C7.571,13.992,7.488,14.297,7.248,14.434z M12,14.5c-0.094,0-0.189-0.026-0.271-0.08l-8.5-5.5 C2.997,8.77,2.93,8.46,3.081,8.229c0.15-0.23,0.459-0.298,0.691-0.147L12,13.405l8.229-5.324c0.232-0.15,0.542-0.084,0.691,0.147 c0.15,0.232,0.083,0.542-0.148,0.691l-8.5,5.5C12.189,14.474,12.095,14.5,12,14.5z M20.934,16.248 C20.842,16.41,20.673,16.5,20.5,16.5c-0.084,0-0.169-0.021-0.248-0.065l-3.5-2c-0.24-0.137-0.323-0.442-0.186-0.682 s0.443-0.322,0.682-0.186l3.5,2C20.988,15.703,21.071,16.009,20.934,16.248z"/>
        </svg>
      </div>
      <span>Email</span>
    </div>
  </a>
  {% endunless %}
</script>

<script
  id="wishlist-share-button-link"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  {% unless wishlist.empty %}
  <a href="#" class="wk-button-share resp-sharing-button__link" title="Share via link" data-wk-share-service="link" data-wk-share="{{ wishlist.permaId }}">
    <div class="resp-sharing-button resp-sharing-button--link resp-sharing-button--large">
      <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg version='1.1' xmlns='https://www.w3.org/2000/svg' width='512' height='512' viewBox='0 0 512 512'>
          <path d='M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813
          l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0
          l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219
          c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0
          C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0
          c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125
          c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0
          l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594
          C274.561,395.092,246.42,392.342,220.326,382.186z'/>
        </svg>
      </div>
      <span>E-Mail</span>
    </div>
  </a>
  {% endunless %}
</script>

<script
  id="wishlist-share-button-contact"
  data="wishlist"
  type="text/x-template"
  app="wishlist-king"
>
  {% unless wishlist.empty %}
  <a href="#" class="wk-button-share resp-sharing-button__link" title="Send to customer service" data-wk-share-service="contact" data-wk-share="{{ wishlist.permaId }}">
    <div class="resp-sharing-button resp-sharing-button--link resp-sharing-button--large">
      <div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
        <svg height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M19 2H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h4l3 3 3-3h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-6 16h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 11.9 13 12.5 13 14h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>
        </svg>
      </div>
      <span>E-Mail</span>
    </div>
  </a>
  {% endunless %}
</script>

{% endraw %}

<script>
  function appmateSelectCallback(variant, selector) {
    var shop = Appmate.wk.globals.shop;
    var product = Appmate.wk.getProduct(variant.product_id);
    var itemId = Appmate.wk.$(selector.variantIdField).parents('[data-wk-item]').attr('data-wk-item');
    var container = Appmate.wk.$('#wk-item-' + itemId);


    {% if page.template_suffix == 'wishlist' %}
    if (variant) {
      Appmate.wk.updateItem(itemId, {selected_variant_id: variant.id});
    }
    {% endif %}

    var imageUrl = '';

    if (variant && variant.image) {
      imageUrl = Appmate.wk.filters.img_url(variant, '1000x');
    } else if (product) {
      imageUrl = Appmate.wk.filters.img_url(product, '1000x');
    }

    if (imageUrl) {
      container.find('.wk-variant-image').attr('src', imageUrl);
    }

    var formatMoney = Appmate.wk.filters.money;

    if (!product.hidden && variant && (variant.available || variant.inventory_policy === 'continue')) {
      container.find('.wk-add-to-cart').removeAttr('disabled').removeClass('disabled').attr('value', 'Add to Cart');
      if(parseFloat(variant.price) < parseFloat(variant.compare_at_price)){
        container.find('.wk-price-preview').html(formatMoney(variant.price) + " <del>" + formatMoney(variant.compare_at_price) + "</del>");
      } else {
        container.find('.wk-price-preview').html(formatMoney(variant.price));
      }
    } else {
      var message = variant && !product.hidden ? "Sold Out" : "Unavailable";
      container.find('.wk-add-to-cart').addClass('disabled').attr('disabled', 'disabled').attr('value', message);
      container.find('.wk-price-preview').text(message);
    }

  };

  function appmateOptionSelect(el){
    if (!Shopify || !Shopify.OptionSelectors) {
      throw new Error('Missing option_selection.js! Please check templates/page.wishlist.liquid');
    }

    var id = el.getAttribute('id');
    var itemId = Appmate.wk.$(el).parents('[data-wk-item]').attr('data-wk-item');
    var container = Appmate.wk.$('#wk-item-' + itemId);

    Appmate.wk.getItem(itemId).then(function(product){
      var selector = new Shopify.OptionSelectors(id, {
        product: product,
        onVariantSelected: appmateSelectCallback,
        enableHistoryState: false
      });

      if (product.selected_variant_id) {
        selector.selectVariant(product.selected_variant_id);
      }

      selector.selectors.forEach(function(selector){
        if (selector.values.length < 2) {
          Appmate.wk.$(selector.element).parents(".selector-wrapper").css({display: "none"});
        }
      });

      // Add label if only one product option and it isn't 'Title'.
      if (product.options.length == 1 && product.options[0] != 'Title') {
        Appmate.wk.$(container)
        .find('.selector-wrapper:first-child')
        .prepend('<label>' + product.options[0] + '</label>');
      }
    });
  }
</script>

<script
  src="https://az814789.vo.msecnd.net/toolkit/1.4.43/appmate.js"
  async
></script>
<link
  href="{{ 'appmate-wishlist-king.scss.css' | asset_url }}"
  rel="stylesheet"
/>
{% comment %}
<link
  href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/3.4.2/css/swiper.min.css"
  rel="stylesheet"
/>
<script
  src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/3.4.2/js/swiper.min.js"
  async
></script>
{% endcomment %}
